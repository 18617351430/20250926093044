防伪码系统需求文档（最终版）
1. 项目概述
1.1 项目背景
当前市场假冒伪劣产品问题突出，企业亟需数字化防伪手段保护品牌，消费者对商品真伪验证需求迫切。本系统旨在通过 "平台 + 多商户" 模式，提供防伪码生成与验证、商品全流程溯源服务，同时通过严格的权限隔离机制，满足平台方与商户的分级管理需求，实现防伪与溯源一体化解决方案。
1.2 项目目标
基于 Go 后端与 Vue 前端技术栈，构建包含防伪码查询前台与后台管理前台的系统，实现：
灵活可控的防伪码生成机制（支持商户自定义规则）
平台 - 商户二级权限管理体系（数据严格隔离）
商品全生命周期溯源信息管理
高效的防伪码验证与查询服务
1.3 技术栈选择
前端：Vue.js（查询前台与后台前台共享技术栈，通过路由与权限隔离），Element Plus 组件库，Vue Router，Vuex
后端：Go 语言，Gin 框架（RESTful API）
数据库：MySQL（业务数据存储），Redis（缓存与会话管理）
部署：初期采用传统部署，后期扩展容器化部署方案
2. 前台架构设计
2.1 防伪码查询前台（面向消费者）
核心功能：支持防伪码手动输入与扫码验证（集成摄像头扫码功能），验证后展示商品真伪状态及关联的溯源信息；注册用户可查看个人查询历史记录。
界面特点：极简设计，操作流程简化至最多 2 步即可完成查询；采用响应式网页设计，可自适应不同设备屏幕（包括手机、平板、PC 等），确保在各类终端上均有良好的显示与操作体验。
访问方式：游客模式可直接使用核心验证功能，无需注册登录；用户注册后可关联查询历史，方便追溯过往验证记录。
个性化展示：根据验证的防伪码所属商户，自动加载该商户预设的品牌展示信息（如品牌 logo、专属配色、品牌简介等）。
2.2 后台前台（面向管理用户）
访问控制：采用统一访问入口，用户登录后系统根据其角色类型（平台管理员、商户管理员等）动态加载对应的功能菜单与操作按钮，无权限的功能自动隐藏。
平台管理员视图：包含全局数据统计看板（全平台商户数量、防伪码生成总量、验证次数等）、商户管理模块、系统参数配置中心、全平台数据监控与异常告警功能。
商户用户视图：包含本商户数据统计看板（本商户商品数量、防伪码状态分布、验证记录趋势等）、商品信息管理、防伪码规则配置与生成、溯源信息维护等功能模块。
界面特点：优先适配 PC 端，支持复杂表单操作、批量数据处理（如批量导入导出）、数据可视化展示（图表、统计报表）等管理场景需求。
3. 用户权限模块
3.1 用户层级与权限边界用go和vue构建一个防伪码系统
平台管理员：由系统初始化创建，是平台最高权限层级。平台管理员可创建下属账号（即平台级下属管理员），并根据自身拥有的权限范围，为下属账号分配部分权限（下属账号权限不得超过创建者权限）。其核心权限包括全平台商户的创建与状态管理（启用 / 禁用）、系统全局参数配置（如防伪码长度限制、商户权限上限）、全平台数据查看与监控；数据访问边界为系统内所有商户的全量数据。
平台级下属管理员：由平台管理员创建，权限范围由平台管理员根据业务需求分配。例如，平台运营下属管理员可获得商户管理、数据统计权限，但无系统配置权限；平台技术下属管理员可获得系统配置、日志查看权限，但无商户管理权限。其数据访问边界与所分配的权限对应，仅能访问权限范围内的全平台数据。
商户管理员：由平台管理员在创建商户时生成初始账号，或由平台管理员指定现有用户担任，是商户内最高权限层级。商户管理员可创建本商户的下属账号，并为其分配本商户内的部分权限（下属账号权限不得超过商户管理员权限）。其核心权限包括本商户用户管理（创建、编辑、禁用）、本商户防伪码规则配置、本商户功能模块授权；数据访问边界仅限本商户内的所有数据。
商户下属账号：由商户管理员创建，权限范围由商户管理员根据业务分工分配。例如，商户商品专员可获得商品信息管理、防伪码生成权限；商户溯源专员可获得溯源信息录入与维护权限；商户数据专员可获得本商户数据查询与统计权限。其数据访问边界仅限本商户内被授权访问的数据。
3.2 角色与权限设计
平台级角色：包括平台超级管理员（拥有平台全部权限）、平台运营专员（权限涵盖商户管理、全平台数据统计）、平台技术支持（权限涵盖系统配置、日志查看、故障处理），所有平台级角色的权限由平台管理员统一配置与管理。
商户级角色：包括商户管理员（拥有本商户全部权限）、商品专员（权限涵盖商品信息维护、防伪码生成与管理）、溯源专员（权限涵盖溯源信息采集、编辑、关联）、数据专员（权限涵盖本商户数据查询、统计报表生成），所有商户级角色的权限由商户管理员在本商户范围内配置与管理。
权限控制机制：基于 RBAC（Role-Based Access Control）模型设计，实现三级权限控制：菜单权限（控制是否可见某功能菜单）、按钮权限（控制是否可见某操作按钮，如 "删除"" 导出 "）、数据权限（控制可访问的数据范围，如仅限本商户数据）。所有系统操作均需携带用户身份与所属商户标识（平台用户商户标识为特殊值），通过权限中间件实时校验权限合法性。
4. 防伪码模块（核心）
4.1 生成机制与规则配置
核心结构：以 "商户标识 + 批次标识 + 序号" 为基础框架，确保防伪码全局唯一性。其中，商户标识为系统分配的 2-6 位唯一编码（平台统一配置长度）；批次标识为商户内自定义的 2-8 位批次编码（可包含数字、字母）；序号为批次内的流水号（最大支持 9 位，满足单批次大容量需求）。
自定义规则（由商户管理员配置）：
前置位：可添加 1-5 位自定义内容（支持数字、字母、特定符号，如品牌缩写）。
随机数字：可插入 1-8 位随机数字，位置可自由选择（如前置位后、批次标识前、序号后等）。
指定数字：可添加 1-6 位固定序列（如企业代码、生产年份、区域代码等）。
字符类型与格式：支持选择纯数字、数字 + 字母（大小写可选），可添加分隔符（如 "-""#"）提升可读性。
长度控制：防伪码总长度限制在 16-32 位（平衡防伪安全性与用户输入便捷性）。
生成示例：若规则为 "前置位（2 位，如 AB）+ 商户标识（4 位，如 8866）+ 随机数（4 位，如 5789）+ 批次标识（3 位，如 B23）+ 指定数字（2 位，如 00）+ 序号（6 位，如 120231）"，则生成的防伪码为 "AB88665789B2300120231"。
4.2 生成与存储管理
批量生成：支持按商户配置的规则批量生成防伪码，单批次最大支持 500 万条；生成过程采用异步任务模式，支持断点续传（网络中断或系统异常后，可从上次中断位置继续生成），避免重复劳动。
分表策略：采用分表存储机制，按 "商户 ID + 批次 ID" 哈希计算分片标识，每张表最多存储 500 万条防伪码记录，确保数据存储均衡且查询高效；分表逻辑对上层业务透明，由系统自动处理。
导出功能：支持将生成的防伪码按批次导出为 Excel 或 TXT 格式；当单批次防伪码数量超过 10 万条时，自动分卷导出（每卷不超过 10 万条）；导出文件包含防伪码本体及印刷所需的辅助信息（如对应批次、生成时间、二维码图片链接等）。
4.3 验证与管理
验证流程：用户输入或扫码提交防伪码后，系统先校验格式（是否符合该商户配置的规则），再校验状态（未使用 / 已使用 / 已作废），最后返回验证结果（含真伪状态、首次查询时间、查询次数等）。
管理功能：
状态跟踪：实时记录防伪码状态（未使用：未被查询过；已使用：至少被查询过一次；已作废：因产品召回、印刷错误等原因被手动标记为无效）。
批量操作：支持对本商户某批次防伪码进行批量状态更新（如产品召回时批量标记为作废，并记录操作原因）。
异常监控：对多次验证（同一防伪码被查询超过预设次数）、跨区域验证（短时间内异地查询）等异常情况进行标记，商户管理员可查看异常记录并配置告警阈值。
5. 商品溯源模块
5.1 商品与批次管理
商品信息：由商户管理员或授权账号维护本商户商品的基础信息，包括商品名称、规格型号、产品描述、图片（正面图、侧面图、细节图等）、所属分类（需符合平台统一的商品分类体系）等；商品信息支持编辑更新，更新记录自动存档。
批次管理：每款商品可创建多个生产批次，批次信息包括批次编号（与防伪码批次标识关联）、生产时间、生产线编号、生产负责人、质检报告等；批次创建后需与对应批次的防伪码绑定，确保防伪码与商品批次的唯一关联。
5.2 溯源信息采集
环节覆盖：支持采集商品全生命周期各环节的信息，包括生产环节（原材料供应商、原材料批次、生产工艺参数、生产人员）、仓储环节（入库时间、仓库位置、存储条件、出库时间）、物流环节（物流商、运输车辆、起止地点、运输时间、签收信息）、销售环节（经销商信息、销售时间、销售区域、终端门店）。
信息载体：支持多种类型的溯源信息录入，包括文本描述、日期时间、人员姓名、图片（如生产现场照片、仓储环境照片、物流单据照片）、文件附件（如质检报告 PDF、原材料合格证明）等。
5.3 溯源查询
消费者视角：通过验证防伪码后，系统自动关联展示该商品所属批次的溯源信息，以时间线形式可视化呈现各环节关键信息；展示内容范围由商户管理员配置（可隐藏部分敏感信息，如供应商联系方式）。
商户视角：商户管理员及授权账号可查看本商户商品批次的全量溯源信息（包括消费者不可见的内部信息），支持编辑补充未完善的溯源数据，管理各环节信息的公开范围。
6. 非功能需求
6.1 性能要求
查询前台：防伪码验证接口响应时间≤500ms，页面加载时间≤1.5 秒；支持同时在线用户≥10 万，峰值验证请求≥5000 QPS。
后台前台：单商户数据查询响应时间≤1 秒，跨商户统计查询（平台管理员操作）响应时间≤3 秒；批量生成 500 万条防伪码的处理时间≤3 分钟；支持同时在线管理用户≥1000，峰值操作请求≥500 QPS。
6.2 安全性要求
数据隔离：数据库层面所有业务表均包含商户 ID 字段，非平台管理员的查询操作自动附加商户 ID 条件，从底层防止跨商户数据访问。
规则保护：商户防伪码生成规则采用加密算法存储，即使平台管理员也无法直接查看完整规则，仅在生成防伪码时由系统解密使用。
传输安全：全系统采用 HTTPS 加密传输数据，防止数据在传输过程中被窃取或篡改；敏感操作（如批量作废防伪码、修改权限配置）需二次验证（密码或验证码）。
防伪造：防伪码生成时嵌入校验位，验证过程中自动校验完整性；生成算法采用不可逆设计，确保无法通过已知防伪码推测生成规则。
6.3 可靠性要求
系统可用性≥99.9%，支持 7×24 小时不间断运行；采用商户级故障隔离机制，单个商户的系统异常（如数据错误、操作失败）不影响其他商户及平台核心功能。
数据备份：按商户粒度每日自动备份数据，备份文件保存≥30 天；支持单商户数据恢复（恢复至指定时间点），确保数据误操作后可挽回。
操作日志：所有敏感操作（如权限变更、防伪码状态修改、商户创建 / 禁用）均记录详细日志（包括操作人、操作时间、操作内容、IP 地址），日志保存≥1 年，支持查询与导出。
7. 系统架构
7.1 总体架构
采用前后端分离架构，防伪码查询前台与后台前台通过 HTTP/HTTPS 调用后端 API 服务；后端通过权限中间件对请求进行身份验证与权限校验，确保数据访问安全。
后端采用分层设计：API 层（接收请求、参数验证、返回响应）→ 业务逻辑层（按平台 / 商户维度实现核心业务逻辑，如防伪码生成、权限校验）→ 数据访问层（处理数据库交互，含分表逻辑、事务管理）。
核心服务组件：规则引擎（解析与执行防伪码生成规则）、验证服务（处理防伪码验证请求）、溯源服务（管理溯源信息的增删改查）、权限服务（维护用户 - 角色 - 权限关系，执行权限校验）。
7.2 核心数据表
商户表（merchants）：存储商户 ID、名称、状态、配置参数（如防伪码规则上限）等基础信息。
用户表（users）：存储用户 ID、账号、密码（加密存储）、用户类型（平台 / 商户）、所属商户 ID、角色 ID 等信息。
角色表（roles）：存储角色 ID、角色名称、角色类型（平台级 / 商户级）、所属商户 ID（商户级角色）等信息。
权限表（permissions）：存储权限 ID、权限名称、权限标识（如 "code:generate"）、权限类型（菜单 / 按钮）等信息。
角色权限关联表（role_permissions）：记录角色与权限的多对多关系。
防伪码规则表（security_code_rules）：存储商户 ID、规则 ID、各组成部分配置（前置位、随机数等）、总长度限制等规则信息（加密存储）。
防伪码分表（security_codes_${shard_id}）：按分片 ID 分表，存储防伪码本体、商户 ID、批次 ID、序号、生成时间、状态、校验位等信息。
商品表（products）：存储商品 ID、商户 ID、名称、规格、分类、图片等信息。
商品批次表（product_batches）：存储批次 ID、商品 ID、商户 ID、批次标识、生产信息等。
溯源信息表（traceability_infos）：存储溯源 ID、批次 ID、商户 ID、环节类型（生产 / 仓储等）、信息内容、附件地址等。
验证记录表（verification_records）：存储验证 ID、防伪码、商户 ID、验证时间、验证 IP、验证结果等。
8. 实施计划
第一阶段：完成需求细化与确认，输出详细设计文档（包括系统架构设计、数据库设计、接口设计）；重点设计防伪码规则引擎与权限隔离机制。
第二阶段：开发用户权限模块（用户管理、角色管理、权限控制），实现平台 - 商户数据隔离机制；开发后台前台基础框架（登录、菜单加载、权限校验）。
第三阶段：开发防伪码核心模块，包括规则配置界面、防伪码生成引擎（含批量生成与断点续传）、分表存储逻辑、验证服务；开发查询前台基础功能（验证入口、结果展示）。
第四阶段：开发商品溯源模块（商品与批次管理、溯源信息采集、溯源查询展示）；完成前后台前台功能集成，实现各模块间的数据关联。
第五阶段：进行系统测试，包括功能测试（验证各模块功能正确性）、权限边界测试（确保数据隔离有效）、性能测试（验证大批量生成与高并发验证性能）；修复测试中发现的 Bug，优化系统响应速度。
第六阶段：完成系统部署（传统部署方式），编写用户操作手册（区分平台管理员、商户管理员、消费者等角色）；开展用户培训（平台操作培训、商户使用培训）；组织项目验收。
9. 附录
术语定义：平台管理员（负责全平台管理的用户）、商户管理员（负责单个商户管理的用户）、防伪码规则（生成防伪码的结构配置）、分表（按规则拆分的数据库表，用于存储大量防伪码）等。
权限矩阵说明：详细列举各角色（如平台超级管理员、商户商品专员）可访问的菜单、可执行的操作、可查看的数据范围，作为开发与测试的权限校验依据。
分表策略详情：说明分片 ID 的计算方式（哈希算法）、分表扩容机制（当单表接近 500 万条时自动创建新表）、跨表查询处理逻辑等。
需求变更流程：明确需求变更的申请方式（需提交变更说明与理由）、评审流程（由项目组评估影响与可行性）、实施规则（通过评审后纳入开发计划）。
本需求文档为系统开发、测试、验收的基准依据，实施过程中如需调整，需严格遵循需求变更流程。